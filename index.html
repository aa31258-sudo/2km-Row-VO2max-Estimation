<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VO₂max Estimation (2k Row)</title>

<style>
body { font-family: Arial, sans-serif; padding: 20px; max-width: 560px; margin: auto; }
label { display: block; margin-top: 14px; font-weight: bold; }
input, select { width: 100%; font-size: 1.1em; padding: 10px; margin-top: 6px; box-sizing: border-box; }
.row { display: flex; gap: 10px; align-items: end; }
.row > div { flex: 1; }
.note { margin-top: 8px; font-size: 0.95em; opacity: 0.85; }
.result { margin-top: 18px; font-size: 1.35em; font-weight: bold; }
.subresult { margin-top: 6px; font-size: 1.05em; }
.warn { margin-top: 10px; color: #b00020; font-weight: bold; }
.ok { margin-top: 10px; color: #0b6b0b; font-weight: bold; }
.divider { margin-top: 18px; border-top: 1px solid #ddd; padding-top: 14px; }
</style>
</head>

<body>
<h2>VO₂max Estimation (2 km Row)</h2>

<!-- TIME INPUT (MINUTES + SECONDS) -->
<label>2 km Row Time</label>
<div class="row">
<div>
<label style="margin-top:0;">Minutes</label>
<input id="timeMin" type="number" inputmode="numeric" min="0" step="1" placeholder="e.g., 7" oninput="calculate()">
</div>
<div>
<label style="margin-top:0;">Seconds</label>
<input id="timeSec" type="number" inputmode="numeric" min="0" max="59" step="1" placeholder="e.g., 0" oninput="calculate()">
</div>
</div>
<div class="note">Seconds must be 0–59.</div>
function toKg(weight, unit) {
if (!Number.isFinite(weight) || weight <= 0) return NaN;
return unit === "lb" ? (weight * 0.45359237) : weight;
}

function heightToMeters(h1, h2, unit) {
if (!Number.isFinite(h1) || h1 <= 0) return NaN;

if (unit === "ftin") {
const feet = h1;
const inches = Number.isFinite(h2) ? h2 : 0;
if (feet < 0 || inches < 0) return NaN;
const totalInches = (feet * 12) + inches;
return totalInches * 0.0254;
}
if (unit === "cm") return h1 / 100;
if (unit === "m") return h1;

return NaN;
}

function calculate() {
const msg = document.getElementById("messages");
msg.innerHTML = "";

// --- TIME: minutes + seconds -> total seconds ---
const minVal = parseInt(document.getElementById("timeMin").value, 10);
const secVal = parseInt(document.getElementById("timeSec").value, 10);

const minutes = Number.isFinite(minVal) ? minVal : NaN;
const seconds = Number.isFinite(secVal) ? secVal : NaN;

const tSec = (Number.isFinite(minutes) && Number.isFinite(seconds))
? (minutes * 60 + seconds)
: NaN;

// Sex
const sex = parseFloat(document.getElementById("sex").value);

// Weight
const wVal = parseFloat(document.getElementById("weight").value);
const wUnit = document.getElementById("weightUnit").value;
const kg = toKg(wVal, wUnit);

// Height
const hUnit = document.getElementById("heightUnit").value;
const h1 = parseFloat(document.getElementById("height1").value);
const h2 = parseFloat(document.getElementById("height2").value);
const meters = heightToMeters(h1, h2, hUnit);

// Validate time first (and show seconds)
if (!Number.isFinite(tSec) || minutes < 0 || seconds < 0 || seconds > 59) {
document.getElementById("secOut").textContent = "—";
document.getElementById("bmiOut").textContent = "—";
document.getElementById("output").textContent = "—";
msg.innerHTML = `<div class="warn">Enter valid time (minutes ≥ 0, seconds 0–59).</div>`;
return;
}
document.getElementById("secOut").textContent = tSec.toString();

// Validate sex
if (!Number.isFinite(sex)) {
document.getElementById("bmiOut").textContent = "—";
document.getElementById("output").textContent = "—";
msg.innerHTML = `<div class="warn">Select sex.</div>`;
return;
}

// Calculate BMI
let bmi = NaN;
if (Number.isFinite(kg) && Number.isFinite(meters) && meters > 0) {
bmi = kg / (meters * meters);
document.getElementById("bmiOut").textContent = bmi.toFixed(1);
} else {
document.getElementById("bmiOut").textContent = "—";
document.getElementById("output").textContent = "—";
msg.innerHTML = `<div class="warn">Enter valid weight and height.</div>`;
return;
}

// VO2max equation:
// VO2max = 133.051 - (0.086*row_time_seconds) - (8.289*sex) - (1.433*BMI)
const vo2max = 133.051 - (0.086 * tSec) - (8.289 * sex) - (1.433 * bmi);

document.getElementById("output").textContent = vo2max.toFixed(2) + " ml·kg⁻¹·min⁻¹";
msg.innerHTML = `<div class="ok">Calculated.</div>`;
}

// Initialize UI on load
handleHeightUnitChange();
</script>
</body>
</html>
